# i2c

1. I2C分为SCL和SDA，必须接上拉电阻，一般4.7k
2. I2C总线支持多从机，通过从机地址区分

## I2C协议

1. 起始位：SCL高电平，SDA出现下降沿
2. 停止位：SCL高电平，SDA出现下降沿
3. 数据传输：只允许在SCL低电平时发生数据传输（否则就是判断为起始/停止）
4. 应答信号：主机发送完8bit数据后，从机紧跟着SDA低电平信号表示应答

### I2C写时序

![i2c_write](https://github.com/sybc120404/image4md/blob/main/i2c_write.png)

1. 发送起始信号
2. 发送从机地址，前7bit表示从机地址，最后1bit表示读/写（1-write，0-read）
3. 从机发送ACK
4. 重新发送开始信号
5. 发送写入数据的寄存器地址
6. 等待ACK
7. 发送数据，每发送1B，就必须等待ACK
8. 发送停止信号

### I2C读时序

![i2c_read](https://github.com/sybc120404/image4md/blob/main/i2c_read.png)

1. 发送起始信号
2. 发送从机地址+写位(1)，表示写入要读取的寄存器地址！！！
3. 等待从机ACK
4. 重新发送开始信号
5. 发送要读的寄存器地址
6. 等待从机ACK
7. 发送从机地址+读(1)
8. 等待ACK
9. 主机读取数据
10. 主机发送NO ACK，表示读取完毕
11. 主机发送停止信号，结束I2C通信

## 6ULL I2C接口

6ULL共有四组I2C，环境光传感器使用I2C1，由UART4_TXD和RXD复用而来，复用位ALT2

1. 6U的I2C频率有两种，标准模式下100kbit/s，快速模式下400kbit/s
2. I2C的时钟源选择ipg_clk_root=66MHz

6U有一个I2C控制器，详细寄存器定义在代码注释中

## AP3216C简介

1. I2C接口最高400kbit/s频率
2. 环境光(ALS)为16bit输出，接近传感器为10bit输出
3. 从机地址0x1E

AP3216C的各个寄存器定义详见代码